"""
Esse programa faz parte do Trabalho de Redes de Computadores II 
"""
__author__ = "Gabriel Hishida and Allan Cedric"

import socket

HOST = "127.0.0.1"  # The server's hostname or IP address
PORT = 65010  # The port used by the server cache

with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)

    try:
        s.connect((HOST, PORT))
    except ConnectionRefusedError:
        print("Error: Could not connect to CACHE server")
        exit()
    
    print(f"Connected to CACHE")

    while(True):
        req = input(">>> ")

        data = req.encode('UTF-8')

        s.sendall(data)

        s.settimeout(1.0)

        try:
            data = s.recv(1024)
            data = data.decode("utf-8")

            if data and (not data.startswith("err:")):
                data = eval(data)
                print(f"{req}: {data}")
            
            else:
                print(data)

        except socket.timeout:
            print("No data was received from cache.")